---
title: "Projekt_kod"
format: html
editor: visual
---

# Biblioteki

```{r}
#| message: false
#| warning: false
library(tidyverse)
library(readxl)
library(lmtest)
library(tseries)
library(xtable)
```

# Wczytywanie danych i czyszczenie

```{r}
dane <- read_xlsx("../Ekonometria_projekt/dane/Dane.xlsx")
```

## Czyszczenie danych

```{r}
dane <- dane %>% 
  rename(y = 3) %>% 
  rename_with(.cols = 4:ncol(.), .fn = ~ paste0("x", seq_along(.))) %>% 
  mutate(x5 = x5 %>%
           str_replace(",", "") %>%          
           str_replace(",", "."), x6 = str_remove_all(x6,"\\s"), across(c(x7, x8), ~ str_replace(., "\\.", ""))) %>% 
  mutate(across(c(x5,x6,x7,x8), ~ as.numeric(.x)))

```

# Regresja Krokowa

### Krok 1

```{r}
model <- lm(y ~ x1 + x2 + x3 + x4 + x5 + x6 + x7 + x8, data = dane)
summary(model) %>% 
  xtable()
```

### Krok 2

```{r}
model <- lm(y ~ x1 + x2 + x4 + x5 + x6 + x7 + x8, data = dane)
summary(model)
```

### Krok 3

```{r}
model <- lm(y ~ x1 + x2 + x4 + x5 + x6 + x8, data = dane)
summary(model)
```

### Krok 4

```{r}
model <- lm(y ~ x1 + x2 + x4 + x5 + x8, data = dane)
summary(model)
```

### Krok 5

```{r}
model_koncowy <- lm(y ~ x1 + x2 + x5 + x8, data = dane)
summary(model_koncowy)
```

# Modele jednowymiarowe

### Dla x1

```{r}
wykres1 <- ggplot(dane, aes(y = y, x = x1))+
  geom_point()+
  geom_smooth(method = "lm", se = F)+
  theme_minimal()
ggsave("wykres1.png", plot = wykres1, width = 8, height = 6, dpi = 300)
```

### Dla x2

```{r}
wykres2 <- ggplot(dane, aes(y = y, x = x2))+
  geom_point()+
  geom_smooth(method = "lm", se = F)+
  theme_minimal()
wykres2
#ggsave("wykres2.png", plot = wykres2, width = 8, height = 6, dpi = 300)
```

# Testy

### Liniowość – Test RESEST

```{r}
reset <- resettest(model_koncowy) 

reset_df <- data.frame(
  "Statystyka testowa" = reset$statistic,
  "Wartość p" = reset$p.value,
  "Stopnie swobody 1" = reset$parameter[1],
  "Stopnie swobody 2" = reset$parameter[2],
  check.names = FALSE
)
xtable(reset_df, caption = "Wyniki testu RESET dla modelu końcowego", digits = 4)
```

### Homoskedastyczność - Test Goldfelda-Quandta

```{r}
gq <- gqtest(model_koncowy)


gq_df <- data.frame(
  `statystyka` = gq$statistic,
  `df1` = gq$parameter[1],
  `df2` = gq$parameter[2],
  `p-wartość` = gq$p.value,
  check.names = FALSE
)


xtable(gq_df, caption = "Test Goldfelda–Quandta", digits = 4)
```

### Autokorelacja składników losowych – Test Durbina-Watsona

```{r}
dwtest(model_koncowy)
```

### Rozkład normalny reszt – Test JBT

```{r}
reszty <- resid(model_koncowy)
jarque.bera.test(reszty)
```

# Badanie dobroci modelu

### Dobroć dopasowania modelu do obserwacji

### Współczynnik zmienności losowej – siła wpływu czynnika losowego

### Istotność prametrów – pamiętać
